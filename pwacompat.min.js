(function(){function h(){var a=document.head.querySelector('link[rel="manifest"]'),b=a?a.href:"",d=z([b,window.location]);Promise.resolve().then(function(){if(!b)throw'can\'t find <link rel="manifest" href=".." />\'';var a={};"use-credentials"===b.crossOrigin&&(a.credentials="include");return window.fetch(b,a)}).then(function(a){return a.json()}).then(function(a){return A(a,d)})["catch"](function(a){return console.warn("pwacompat.js error",a)})}function z(a){for(var b={},d=0;d<a.length;b={opt:b.opt},
++d){b.opt=a[d];try{return new URL("",b.opt),function(a){return function(b){return(new URL(b,a.opt)).toString()}}(b)}catch(e){}}return function(a){return a}}function r(a,b){var d=document.createElement(a),e;for(e in b)d.setAttribute(e,b[e]);document.head.appendChild(d);return d}function c(a,b){b&&(!0===b&&(b="yes"),r("meta",{name:a,content:b}))}function A(a,b){function d(b,d,f){var k=b.width,e=b.height,c=window.devicePixelRatio;b=t({width:k*c,height:e*c});b.scale(c,c);b.fillStyle=a.background_color||
"#f8f9fa";b.fillRect(0,0,k,e);b.translate(k/2,(e-32)/2);b.font="24px HelveticaNeue-CondensedBold";b.fillStyle=q?"white":"black";k=b.measureText(u).width;f&&(e=f.width/c,c=f.height/c,128<c&&(e/=c/128,c=128),48<=e&&48<=c&&(b.drawImage(f,e/-2,c/-2,e,c),b.translate(0,c/2+32)));b.fillText(u,k/-2,0);f=document.createElement("link");f.setAttribute("rel","apple-touch-startup-image");f.setAttribute("media","(orientation: "+d+")");f.setAttribute("href",b.canvas.toDataURL());return f}function e(a){var b=d(window.screen,
"portrait",a);a=d({width:window.screen.height,height:window.screen.width},"landscape",a);v.forEach(function(a){return a.remove()});document.head.appendChild(b);document.head.appendChild(a);v.add(b);v.add(a)}var g=a.icons||[];g.sort(function(a,b){return parseInt(b.sizes,10)-parseInt(a.sizes,10)});var w=g.map(function(a){a={rel:"icon",href:b(a.src),sizes:a.sizes};r("link",a);if(n)return a.rel="apple-touch-icon",r("link",a)}),p=a.display;g=-1!==B.indexOf(p);c("mobile-web-app-capable",g);C(a.theme_color||
"black");D&&(c("msapplication-starturl",a.start_url||"/"),c("msapplication-TileColor",a.theme_color));document.head.querySelector('[name="theme-color"]')||c("theme-color",a.theme_color);var h=E(a.orientation);c("x5-orientation",h);c("screen-orientation",h);"fullscreen"===p?(c("x5-fullscreen","true"),c("full-screen","yes")):g&&(c("x5-page-mode","app"),c("browsermode","application"));if(n){var q=x(a.background_color||"#f8f9fa"),u=a.name||a.short_name||document.title;(p=F(a.related_applications))&&c("apple-itunes-app",
"app-id="+p);c("apple-mobile-web-app-capable",g);c("apple-mobile-web-app-title",u);var v=new Set;e(null);if(w.length){var m=w[0],l=new Image;l.crossOrigin="anonymous";l.onload=function(){e(l);if(a.background_color){var b=y(l,a.background_color);null!==b&&(m.href=b,w.slice(1).forEach(function(b){var d=new Image;d.crossOrigin="anonymous";d.onload=function(){var c=y(d,a.background_color,!0);b.href=c};d.src=b.href}))}};l.src=m.href}}}function F(a){var b;(a||[]).filter(function(a){return"itunes"===a.platform}).forEach(function(a){a.id?
b=a.id:(a=a.url.match(/id(\d+)/))&&(b=a[1])});return b}function E(a){a=String(a||"");a=a.substr(0,3);return"por"===a?"portrait":"lan"===a?"landscape":""}function C(a){if(n||G){var b=x(a);if(n)c("apple-mobile-web-app-status-bar-style",b?"black":"default");else{try{var d=Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar}catch(e){d=null}null===d?console.debug("found Windows, could not fetch titleBar"):(d.foregroundColor=q(b?"black":"white"),d.backgroundColor=q(a))}}}function q(a){a=
m(a);return{r:a[0],g:a[1],b:a[2],a:a[3]}}function m(a){var b=t();b.fillStyle=a;b.fillRect(0,0,1,1);return b.getImageData(0,0,1,1).data}function x(a){a=m(a).map(function(a){a/=255;return.03928>a?a/12.92:Math.pow((a+.055)/1.055,2.4)});return 3<Math.abs(1.05/(.2126*a[0]+.7152*a[1]+.0722*a[2]+.05))}function y(a,b,d){d=void 0===d?!1:d;var c=t(a);c.drawImage(a,0,0);if(!d&&255==c.getImageData(0,0,1,1).data[3])return null;c.globalCompositeOperation="destination-over";c.fillStyle=b;c.fillRect(0,0,a.width,
a.height);return c.canvas.toDataURL()}function t(a){var b=void 0===a?{width:1,height:1}:a;a=b.width;b=b.height;var c=document.createElement("canvas");c.width=a;c.height=b;return c.getContext("2d")}if("fetch"in window){var B=["standalone","fullscreen","minimal-ui"],n=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple"),D=navigator.userAgent&&-1!==navigator.userAgent.indexOf("Edge"),G="undefined"!==typeof Windows;"complete"===document.readyState?h():window.addEventListener("load",h)}})();
